{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://emcsllc.local/schemas/EvidenceArchiveManifest.schema.json",
  "title": "EvidenceArchiveManifest Schema",
  "description": "Defines the structure and integrity rules for long-term evidence archive manifests in PMDocu-DR.",
  "type": "object",
  "required": [
    "$schema",
    "archive_id",
    "archive_version",
    "created_utc",
    "description",
    "generated_by",
    "evidence_summary",
    "file_index",
    "environment"
  ],
  "additionalProperties": false,
  "properties": {
    "$schema": { "type": "string" },
    "archive_id": {
      "type": "string",
      "description": "Unique identifier for this archive bundle, e.g. PMDOCU-DR-2025-Q4."
    },
    "archive_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the archive manifest schema."
    },
    "created_utc": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp (UTC) when this archive was created."
    },
    "description": { "type": "string" },
    "generated_by": {
      "type": "object",
      "required": ["tool", "version"],
      "additionalProperties": false,
      "properties": {
        "tool": { "type": "string" },
        "version": { "type": "string" },
        "executed_by": { "type": ["string", "null"] }
      }
    },
    "evidence_summary": {
      "type": "object",
      "required": ["build_results", "sign_results", "verify_results", "schema_results", "total_artifacts"],
      "additionalProperties": false,
      "properties": {
        "build_results": { "type": "integer", "minimum": 0 },
        "sign_results": { "type": "integer", "minimum": 0 },
        "verify_results": { "type": "integer", "minimum": 0 },
        "schema_results": { "type": "integer", "minimum": 0 },
        "total_artifacts": { "type": "integer", "minimum": 0 }
      }
    },
    "file_index": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["file", "hash_sha256"],
        "properties": {
          "file": { "type": "string" },
          "hash_sha256": {
            "type": "string",
            "pattern": "^[A-Fa-f0-9]{64}$"
          }
        },
        "additionalProperties": false
      }
    },
    "environment": {
      "type": "object",
      "required": ["os", "ps_version", "hostname"],
      "properties": {
        "os": { "type": "string" },
        "ps_version": { "type": "string" },
        "hostname": { "type": "string" }
      },
      "additionalProperties": false
    },
    "signature": {
      "type": "object",
      "required": ["signed_by", "signed_utc", "signature_file", "hash_file"],
      "properties": {
        "signed_by": { "type": "string" },
        "signed_utc": { "type": "string", "format": "date-time" },
        "signature_file": { "type": "string" },
        "hash_file": { "type": "string" }
      },
      "additionalProperties": false
    }
  }
}
