name: Verify Signatures

on:
  workflow_dispatch:
  workflow_run:
    workflows: ["Build and Sign Docs"]
    types:
      - completed

jobs:
  verify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install PowerShell and GPG
        shell: bash
        run: |
          sudo apt-get update
          sudo apt-get install -y powershell gpg

      - name: Verify signatures
        run: |
          pwsh -File scripts/sign-gpg.ps1 -TargetFile docs/releases/ChangeRequest.pdf -Verify
          pwsh -File scripts/sign-gpg.ps1 -TargetFile docs/releases/ImplementationPlan.pdf -Verify

      - name: Verify hashes
        run: |
          pwsh -File scripts/verify-hash.ps1 -PdfFile docs/releases/ChangeRequest.pdf
          pwsh -File scripts/verify-hash.ps1 -PdfFile docs/releases/ImplementationPlan.pdf
